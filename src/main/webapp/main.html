<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>民宿主页</title>
    <head>
        <meta charset="GB18030">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="description" content="">
        <meta name="author" content="">

        <link rel="stylesheet" href="bootstrap/css/bootstrap.min.css">
        <link rel="stylesheet" href="css/font-awesome.min.css">
        <link rel="stylesheet" href="css/main.css">
        <style>
            .tree li {
                list-style-type: none;
                cursor:pointer;
            }
            table tbody tr:nth-child(odd){background:#F4F4F4;}
            table tbody td:nth-child(even){color:#C00;}
        </style>

    </head>
</head>

<body>
<script src="jquery/jquery-2.1.1.min.js"></script>
<script src="bootstrap/js/bootstrap.min.js"></script>
<script src="script/docs.min.js"></script>
<!-- 头部 start -->

<div class="login_out">
    <a href="main.html">首页</a>
    <a href="login.html">登录</a>
    <a href="register.html">注册</a>
    <a href="myfavorite.html" class="collection">我的收藏</a>
    <a href="javascript:location.href='exitServlet';">退出</a>
    <a href="login.html">出租房源</a>
    <a href="login.html">服务</a>
</div>


<header id="header">

    <div class="top_banner">
        <img src="https://ss0.bdstatic.com/70cFuHSh_Q1YnxGkpoWK1HF6hhy/it/u=3742233776,2068776894&fm=26&gp=0.jpg">
        <img src="https://ss1.bdstatic.com/70cFvXSh_Q1YnxGkpoWK1HF6hhy/it/u=1018153081,1889499588&fm=26&gp=0.jpg">
    </div>

    <div class="shortcut">

        <div class="login">

            <span id="span_username"></span>

        </div>
    </div>
    <div class="header_wrap">
        <div class="topbar">

            <div>
            <div class="table-responsive">

                <div>
                    <form class="form-inline" role="form" style="float:left;">
                        <div class="form-group has-feedback">
                            <div class="input-group">
                                <div class="input-group-addon">城市</div>
                                <input class="form-control has-success" type="text" placeholder="请输入查询城市" id="cityInput">
                                <div class="input-group-addon">民宿类型</div>
                                <select class="form-control has-success" type="text" placeholder="请输入查询名宿类型" id="h_typeInput">
                                    <option   value=""></option>
                                    <option   value="公寓型住宅">公寓型住宅</option>
                                    <option  value="独栋房">独栋房</option>
                                    <option   value="Loft">Loft</option>
                                    <option  value="酒店">酒店</option>
                                    <option   value="酒店式公寓">酒店式公寓</option>
                                    <option  value="精品酒店">精品酒店</option>
                                    <option   value="青年旅舍">青年旅舍</option>
                                    <option  value="农家乐">农家乐</option>
                                    <option   value="度假村">度假村</option>
                                    <option  value="乡村小屋">乡村小屋</option>
                                    <option   value="客栈">客栈</option>
                                    <option  value="蒙古包">蒙古包</option>
                                    <option   value="平房">平房</option>
                                    <option  value="联排别墅">联排别墅</option>
                                    <option   value="木屋">木屋</option>
                                    <option  value="房车">房车</option>
                                    <option  value="帐篷">帐篷</option>
                                    <option   value="露营地">露营地</option>
                                    <option  value="树屋">树屋</option>
                                </select>
                            </div>
                        </div>
                        <button type="button" class="btn btn-warning" onclick="initPage()"><i class="glyphicon glyphicon-search"></i> 查询</button>
                    </form>
                </div>

                <table class="table  table-bordered" >

                    <tbody id="dataTable">


                    </tbody>
                    <tfoot>
                    <tr >
                        <td colspan="6" align="center">
                            <ul class="pagination">
                                <li class="disabled"><a href="#">上一页</a></li>
                                <li class="active"><a href="#">1 <span class="sr-only">(current)</span></a></li>
                                <li><a href="#">2</a></li>
                                <li><a href="#">3</a></li>
                                <li><a href="#">4</a></li>
                                <li><a href="#">5</a></li>
                                <li><a href="#">下一页</a></li>
                            </ul>
                        </td>
                    </tr>

                    </tfoot>
                </table>
            </div>
            </div>

        </div>
    </div>
</header>


<script>
    function initPage(){
        // var pageNum = window.location.search.split("=")[1];
        $.ajax({
            //请求方式
            type : "POST",
            //请求的媒体类型
            contentType: "application/json;charset=UTF-8",
            //接受数据类型
            dataType:"json",
            //请求地址
            //url : "http://localhost:8080//getHousePicture",
            url : "http://localhost:8080//getHouseInfo",
            //数据，json字符串
            data : JSON.stringify(
                {
                    "city": $("#cityInput").val().replace(/\s*/g,""),
                    "h_type": $("#h_typeInput").val().replace(/\s*/g,""),
                      // "pageNum":pageNum
                }
            ),
          //请求成功
            success : function(result) {
                console.log(result);
            if (result!=null&&result!="")
                {
                    $("#dataTable").html("");
                     // console.log(result);
                    //2.将数据填充到table中
                    var trStr = "<tr>";
                    var a;
                    $(result).each(function (index, item) {
                        if (index==0){
                            trStr += "<td><img src=\"" + item.picture + "\" onclick='toOrder(" + item.houseid + ")'></td>";
                            trStr += "<td>" + item.h_price + "元" + "</td>";
                            trStr += "<td>" + item.h_type + "</td>";
                            trStr += "<td>" + item.city + "</td>";
                            trStr += "<td>" + item.sketch + "</td>";
                            trStr += "</tr>";
                            //$("#dataTable").append(trStr);
                            a=item.houseid;
                        } else if(item.houseid!=a) {
                            trStr += "<td><img src=\"" + item.picture + "\" onclick='toOrder(" + item.houseid + ")'></td>";
                            trStr += "<td>" + item.h_price + "元" + "</td>";
                            trStr += "<td>" + item.h_type + "</td>";
                            trStr += "<td>" + item.city + "</td>";
                            trStr += "<td>" + item.sketch + "</td>";
                            trStr += "</tr>";
                            //$("#dataTable").append(trStr);
                            a = item.houseid;
                        }
                        $("#dataTable").html(trStr);
                    });



                }else {  alert("对不起，查询失败");}
            },
            //请求失败，包含具体的错误信息
            error : function(e){

                console.log(e.status);
                console.log(e.responseText);
            }
        });
    }
    initPage();

    function toOrder(houseid) {
        alert(houseid)
        window.location.href="order.html?houseid="+houseid;
    }

</script>
</body>
</html>